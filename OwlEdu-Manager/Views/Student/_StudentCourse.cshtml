<div class="container py-4">
    <div class="btl-card">
        <div class="title row align-items-center g-2">
            <div class="col-12 col-md-8">
                <p class="m-0">Đăng ký khóa học mới</p>
            </div>

            <div class="col-12 col-md-4 text-md-end">
                <input type="text" id="search-box" class="form-control"
                    placeholder="Tìm kiếm..." />
            </div>
        </div>

        <div class="component-container" hx-get="/Components/Datagrid" hx-vals='{"Id": "dgCourse"}' hx-trigger="revealed" data-on-load="onLoadDgCourse"></div>

        <div class="component-container" hx-get="/Components/Pagination" hx-vals='{"Id": "pagDgCourse"}' hx-trigger="revealed" data-on-load="onLoadCoursePagination"></div>
    </div>
</div>

<style>

.title {
    padding-bottom: 10px;
    margin-bottom: 10px;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
}

.title p {
    color: var(--primary);
    font-weight: 700;
    font-size: 26px;
    margin: 0;
}

#search-box:focus {
    box-shadow: none;
    border: 1px solid var(--primary-hover);
}

.btn:hover {
    background-color: var(--primary-hover);
    color: #FFFFFF;
}
</style>

<script type="module">
    import CourseService from "../../js/API/CourseService.js";

    // $(document).ready(function () {
    //     onLoadDgCourse();
    //     onLoadCoursePagination();

    //     $('#search-box').on('input', function () {
    //         const keyword = $(this).val().trim();
    //         onLoadDgCourse(keyword);
    //     });
    // });
    async function onLoadDgCourse(keyword = "") {
        // console.log("Loading courses with keyword:", keyword);

        const headers = [
            "ID",
            "Tên khóa học",
            "Mô tả",
            "Trạng thái",
            "Số buổi học",
            "Học phí"
        ];

        renderDatagridHeader("dgCourse", headers, true);

        try {
            const response = await CourseService.getAllCourses(keyword, 1, 10);
            console.log("Response from API:", response);

            const data = response.map(course => ({
                ID: course.id,
                "Tên khóa học": course.name,
                "Mô tả": course.description,
                "Trạng thái": course.status ? "Hoạt động" : "Không hoạt động",
                "Số buổi học": course.numberOfLessons,
                "Học phí": course.fee
            }));

            fillDatagrid("dgCourse", data, true);

            fillDatagridAction("dgCourse", [
                {
                    text: "Chi tiết",
                    iconClass: "fa-solid fa-info",
                    onClick: function (row) {
                        alert(`Chi tiết khóa học: ${row.ID}`);
                    }
                },
                {
                    text: "Đăng ký",
                    iconClass: "fa-solid fa-arrow-right-to-bracket",
                    onClick: function (row) {
                        alert(`Đăng ký khóa học: ${row.ID}`);
                    }
                }
            ]);
        } catch (error) {
            console.error("Error fetching courses:", error);
        }
    }
    async function onLoadCoursePagination() {
        renderPagination("pagDgCourse", 21, "onPageChange");
        console.log("Pagination loaded");
    }

    async function onPageChange(currentPage) {
        console.log("Current page:", currentPage);
        await onLoadDgCourse("", currentPage);
    }

    window.onLoadDgCourse = onLoadDgCourse;
    window.onLoadCoursePagination = onLoadCoursePagination;
    window.onPageChange = onPageChange;
</script>