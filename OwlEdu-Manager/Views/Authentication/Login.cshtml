<div class="d-flex justify-content-center align-items-center vh-100" style="background: linear-gradient(135deg, var(--info), var(--primary));">
    <div class="login-card col-12 col-md-3">

        <div class="login-title mb-4">
            <img src="~/images/owl.png" class="title-icon" alt="icon" />
            <span>OwlEdu</span>
        </div>
        <p class="text-center text-muted mb-4">Vui lòng nhập thông tin đăng nhập của bạn</p>

        <div id="errorBox" class="error-msg mb-3">
            <i class="fa-solid fa-circle-exclamation me-2"></i> 
            Tài khoản hoặc mật khẩu không đúng!
        </div>

        <div class="mb-3">
            <label class="form-label">Tài khoản</label>
            <input id="username" class="form-control" type="text" placeholder="Nhập tài khoản...">
        </div>

        <div class="mb-3">
            <label class="form-label">Mật khẩu</label>
            <div class="input-group">
                <input id="password" class="form-control" type="password" placeholder="Nhập mật khẩu...">
                <span class="input-group-text" id="togglePass" style="cursor:pointer;">
                    <i class="fa-solid fa-eye"></i>
                </span>
            </div>
        </div>

        <button id="btnLogin" class="btn btn-primary w-100 mt-2">
            <i class="fa-solid fa-right-to-bracket me-2"></i> Đăng nhập
        </button>

        <div class="text-center mt-3">
            <a href="#" class="text-muted" onClick="toggleTheme()">Quên mật khẩu?</a>
        </div>

    </div>
</div>

<style>
.login-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 32px;
    box-shadow: 0px 4px 20px rgba(0,0,0,0.05);
}

.form-label {
    font-weight: 600;
    color: var(--text-main);
}

.form-control {
    border-radius: 8px;
    border: 1px solid var(--border);
    background-color: var(--surface);
    color: var(--text-main);
}

.form-control:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 1px rgba(79,70,229,0.2);
}

#togglePass {
    border: 1px solid var(--border);
    background-color: var(--surface);
    color: var(--text-main);
}

.btn-primary {
    background: var(--primary);
    border-color: var(--primary);
    border-radius: 8px;
    padding: 10px;
    font-weight: 600;
}

.btn-primary:hover {
    background: var(--primary-hover);
    border-color: var(--primary-hover);
}

.title-icon {
    width: 60px;   
    height: 60px;
    margin-right: 10px;
}

.login-title {
    font-weight: 900;
    color: var(--primary);
    display: flex;
    justify-content: center;
    align-content: center;
}   

.login-title span {
    height: fit-content;
    margin: auto 0;
    font-size: 28px;
}

.text-muted {
    color: var(--text-muted) !important;
}

.error-msg {
    display: none;
    font-size: 14px;
    background: var(--error);
    color: white;
    border: none;
    border-radius: 6px;
    opacity: 1;
    padding: 10px 20px;
}

</style>

<script>
$(document).ready(function () {

    $("#togglePass").click(function(){
        let pass = $("#password");
        let icon = $("#togglePass i");

        if (pass.attr("type") === "password") {
            pass.attr("type", "text");
            icon.removeClass("fa-eye").addClass("fa-eye-slash");
        } else {
            pass.attr("type", "password");
            icon.removeClass("fa-eye-slash").addClass("fa-eye");
        }
    });

    $("#btnLogin").click(function () {

        let username = $("#username").val().trim();
        let password = $("#password").val().trim();

        if (username === "" || password === "") {
            showError("Vui lòng nhập đầy đủ thông tin!");
            return;
        }

        // === AJAX LOGIN ===
        $.ajax({
            url: "http://localhost:5284/auth/login",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify({
                Username: username,
                Password: password
            }),
            success: function (res) {
                // Nếu BE trả về 200 OK
                if (res && res.token) {
                } else {
                    showError("Dữ liệu phản hồi không hợp lệ từ server.");
                }
            },
            error: function (xhr) {
                if (xhr.status === 401) {
                    // BE trả Unauthorized
                    showError("Sai username hoặc password!");
                } else {
                    showError("Lỗi kết nối tới server.");
                }
            }
        });
    });

    function showError(msg) {
        const box = $("#errorBox");

        box.text(msg);
        box.css("display", "block");
        box.css("opacity", "1");

        setTimeout(() => {
            box.css("opacity", "0");
            setTimeout(() => box.css("display", "none"), 600);
        }, 2000);
    }
});
</script>
